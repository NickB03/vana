{
  "title": "Embed and log agent output",
  "target_file": "korvus_config/orvus_writer.py",
  "description": "Create a function called `embed_and_log_action(text: str, agent_id: str, user_id: str) `.",
  "context": "This service runs in GCP Cloud Run. It sends text to Vertex AI (textembedding-gecko) for embeddings and logs both the vector and metadata into Supabase's `agent_action_log` table.",
  "steps": [
    "Use existing `vertex_client.embed_text()` to embed the text",
    "Truncate to 2048 tokens if needed before embedding",
    "Use `supabase_client.insert()` to log: agent_id, user_id, embedding vector, timestamp, and preview (first 200 chars)",
    "Return `record_id` or `success: true`"
  ],
  "notes": [
    "This will be called by `agent_bridge.py` after an LLM task is complete.",
    "Supabase schema and auth are already live. Use named insert wrapper."
  ]
}