<artifact type="application/vnd.ant.react" title="3D Physics Simulation">
import { Canvas } from '@react-three/fiber';
import { OrbitControls, Text, Box, Plane } from '@react-three/drei';
import { Physics, RigidBody, CuboidCollider, BallCollider } from '@react-three/rapier';
import { useRef, useState, useEffect } from 'react';
import * as THREE from 'three';

interface FallingBoxProps {
  position: [number, number, number];
  color: string;
}

function FallingBox({ position, color }: FallingBoxProps) {
  const meshRef = useRef<THREE.Mesh>(null);
  const [isHovered, setIsHovered] = useState(false);

  useEffect(() => {
    const interval = setInterval(() => {
      if (meshRef.current && Math.random() > 0.98) {
        const body = meshRef.current.parent as any;
        if (body && body.applyImpulse) {
          body.applyImpulse({ x: (Math.random() - 0.5) * 5, y: 5, z: (Math.random() - 0.5) * 5 }, true);
        }
      }
    }, 100);

    return () => clearInterval(interval);
  }, []);

  return (
    <RigidBody position={position} colliders="cuboid" restitution={0.5}>
      <Box
        ref={meshRef}
        args={[1, 1, 1]}
        onPointerOver={() => setIsHovered(true)}
        onPointerOut={() => setIsHovered(false)}
      >
        <meshStandardMaterial
          color={isHovered ? '#ff00ff' : color}
          emissive={isHovered ? '#ff00ff' : color}
          emissiveIntensity={0.2}
          roughness={0.3}
          metalness={0.7}
        />
      </Box>
    </RigidBody>
  );
}

function BouncingBall() {
  return (
    <RigidBody position={[0, 5, 0]} colliders="ball" restitution={0.9}>
      <mesh castShadow>
        <sphereGeometry args={[0.5, 32, 32]} />
        <meshStandardMaterial
          color="#ffd700"
          emissive="#ffd700"
          emissiveIntensity={0.3}
          roughness={0.1}
          metalness={0.9}
        />
      </mesh>
    </RigidBody>
  );
}

function Ground() {
  return (
    <RigidBody type="fixed" position={[0, -0.5, 0]}>
      <Box args={[20, 1, 20]} receiveShadow>
        <meshStandardMaterial
          color="#2d3748"
          roughness={0.8}
          metalness={0.2}
        />
      </Box>
    </RigidBody>
  );
}

function Walls() {
  return (
    <>
      <RigidBody type="fixed" position={[10.5, 3, 0]}>
        <Box args={[1, 6, 20]} receiveShadow>
          <meshStandardMaterial color="#4a5568" transparent opacity={0.5} />
        </Box>
      </RigidBody>
      <RigidBody type="fixed" position={[-10.5, 3, 0]}>
        <Box args={[1, 6, 20]} receiveShadow>
          <meshStandardMaterial color="#4a5568" transparent opacity={0.5} />
        </Box>
      </RigidBody>
      <RigidBody type="fixed" position={[0, 3, 10.5]}>
        <Box args={[20, 6, 1]} receiveShadow>
          <meshStandardMaterial color="#4a5568" transparent opacity={0.5} />
        </Box>
      </RigidBody>
      <RigidBody type="fixed" position={[0, 3, -10.5]}>
        <Box args={[20, 6, 1]} receiveShadow>
          <meshStandardMaterial color="#4a5568" transparent opacity={0.5} />
        </Box>
      </RigidBody>
    </>
  );
}

function Scene() {
  const boxes: FallingBoxProps[] = [
    { position: [0, 3, 0], color: '#ff6b6b' },
    { position: [2, 4, 2], color: '#4ecdc4' },
    { position: [-2, 5, -2], color: '#45b7d1' },
    { position: [3, 6, -3], color: '#96ceb4' },
    { position: [-3, 7, 3], color: '#ffeaa7' },
  ];

  return (
    <Physics gravity={[0, -9.81, 0]}>
      <ambientLight intensity={0.5} />
      <directionalLight position={[10, 10, 5]} intensity={1} castShadow />
      <pointLight position={[-10, 10, -10]} intensity={0.5} color="#ff00ff" />

      {boxes.map((box, index) => (
        <FallingBox key={index} {...box} />
      ))}

      <BouncingBall />
      <Ground />
      <Walls />

      <OrbitControls enablePan={true} enableZoom={true} enableRotate={true} />

      <Text
        position={[0, 8, 0]}
        fontSize={1}
        color="white"
        anchorX="center"
        anchorY="middle"
      >
        Physics Playground
      </Text>
    </Physics>
  );
}

export default function Physics3D() {
  return (
    <div style={{ width: '100%', height: '400px', background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)', borderRadius: '8px', position: 'relative' }}>
      <Canvas camera={{ position: [15, 10, 15], fov: 50 }} shadows>
        <Scene />
      </Canvas>
      <div style={{
        position: 'absolute',
        bottom: '20px',
        left: '50%',
        transform: 'translateX(-50%)',
        color: 'white',
        textAlign: 'center',
        fontFamily: 'system-ui, sans-serif'
      }}>
        <p style={{ margin: 0, fontSize: '14px' }}>üåç 3D Physics Simulation</p>
        <p style={{ margin: 0, fontSize: '12px', opacity: 0.8 }}>Powered by React Three Rapier ‚Ä¢ Hover over boxes</p>
      </div>
    </div>
  );
}
</artifact>