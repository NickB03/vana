# Vana Local Memory MCP Server: Setup and Usage Guide

## 1. Overview

The Vana Local Memory MCP Server provides a lightweight, local vector database for indexing and retrieving information directly within your development environment. It uses ChromaDB for storage and Sentence Transformers for embeddings, allowing Claude Code to access project-specific context efficiently.

## 2. Prerequisites

*   **Python 3**: Ensure you have Python 3 installed on your system.
*   **Access to `scripts/setup_local_memory.py`**: This script will install the necessary Python dependencies.

## 3. Setup

Follow these steps to set up and configure the Vana Local Memory MCP Server:

### Step 3.1: Install Python Dependencies

The memory server requires specific Python libraries. Run the setup script from your terminal:

```bash
python scripts/setup_local_memory.py
```

This script will install `chromadb` and `sentence-transformers`, which are essential for the memory server's functionality. It will also create a `.memory_db` directory in your project root to store the database files.

### Step 3.2: Configure Claude Code

You need to add the Memory MCP Server to your Claude Code configuration. The `setup_local_memory.py` script generates a `claude_memory_config.json` file with the correct configuration snippet.

1.  **Open your `.claude.json` file**: This file is typically located at `/Users/nick/.claude.json`.
2.  **Locate the `projects` section**: Find the entry corresponding to your current project (e.g., `/Users/nick/Development/vana`).
3.  **Add or update the `memory` entry under `mcpServers`**: Copy the snippet generated by `scripts/setup_local_memory.py` and paste it into the `mcpServers` section. It should look similar to this:

    ```json
    "memory": {
      "command": "python",
      "args": [
        "/Users/nick/Development/vana/scripts/local_memory_server.py"
      ],
      "env": {
        "MEMORY_DB_PATH": "/Users/nick/Development/vana/.memory_db"
      }
    }
    ```
    **Important**: Ensure the `command` and `args` paths are correct for your environment. The `MEMORY_DB_PATH` in `env` should point to where you want the memory database to be stored.

### Step 3.3: Restart Claude Code

After updating `.claude.json`, you must restart your Claude Code extension or the terminal where it's running for the changes to take effect.

### Step 3.4: Index Existing Memory Files (Optional, but Recommended)

If you have existing Markdown files (e.g., in your `.claude/` directory) that you want to index into the memory database, you can run the server with the `--index-existing` argument:

```bash
python scripts/local_memory_server.py --index-existing
```
This will start the server and automatically index all `.md` files found in the specified directory (defaulting to `.claude/`).

## 4. Usage

Once the Memory MCP Server is running, you can use the following tools within Claude Code:

### `search_memory`

Searches your local memory for relevant context based on a query.

*   **Description**: Search local memory for relevant context.
*   **Inputs**:
    *   `query` (string, required): The search query.
    *   `max_results` (integer, optional): Maximum number of results to return (default: 5).
*   **Example**: "search_memory what is the project about"

### `store_memory`

Stores new information in your local memory.

*   **Description**: Store new information in local memory.
*   **Inputs**:
    *   `content` (string, required): The content to store.
    *   `metadata` (object, optional): Additional metadata about the content (e.g., source, topic).
*   **Example**: "store_memory content='The new login flow uses OAuth2' metadata={'source': 'design_meeting_notes', 'topic': 'authentication'}"

### `index_files`

Indexes Markdown files from a specified directory into the memory database.

*   **Description**: Index memory files from a directory.
*   **Inputs**:
    *   `directory` (string, optional): The directory to index (default: `.claude/`).
*   **Example**: "index_files directory='./docs'"

### `memory_stats`

Retrieves statistics about your local memory database.

*   **Description**: Get memory database statistics.
*   **Inputs**: None.
*   **Example**: "memory_stats"

## 5. Troubleshooting

*   **"Memory MCP Server: Status: âœ˜ failed"**:
    *   **Missing Dependencies**: Ensure you have run `python scripts/setup_local_memory.py` successfully. Check the terminal output for any installation errors.
    *   **Incorrect Paths**: Verify that the `command` and `args` paths in your `.claude.json` are correct and point to the `local_memory_server.py` script.
    *   **Database Path Issues**: Ensure the directory specified in `MEMORY_DB_PATH` exists and Claude Code has write permissions to it.
    *   **Python Environment**: Confirm that `python` in your `command` refers to the correct Python executable with the installed dependencies. You might need to use `python3` or the full path to your virtual environment's Python.
*   **"JSON schema is invalid" errors related to memory tools**:
    *   This is less likely after the `vscode` MCP server fix, but if it occurs, ensure your `mcp.server` and `mcp.types` libraries are up-to-date and compatible with Claude Code's requirements.

By following these steps, you should have a fully functional Vana Local Memory MCP Server integrated with your Claude Code environment.
