# Artifact Import Restrictions Guide

## Overview

This document provides comprehensive guidelines for artifact imports in the Vana development environment. Artifacts run in a sandboxed environment with strict import restrictions to ensure security, performance, and compatibility across different execution contexts.

## Why Import Restrictions Exist

Artifacts generated by AI models execute in isolated environments with the following constraints:

1. **Security**: Prevent access to sensitive local files and APIs
2. **Compatibility**: Ensure artifacts work across different browser environments
3. **Performance**: Avoid bundling large dependencies that slow down execution
4. **Reliability**: Prevent conflicts between local project dependencies and artifact dependencies

## Forbidden Import Patterns

### 1. Local Project Imports

❌ **NOT ALLOWED** - Local relative imports that reference your project structure:

```javascript
// ❌ FORBIDDEN - These will NEVER work
import { Button } from "@/components/ui/button"
import { Card } from "./components/card"
import { Avatar } from "../../components/avatar"
```

### 2. Absolute Path Imports

❌ **NOT ALLOWED** - Absolute paths from project root:

```javascript
// ❌ FORBIDDEN - Project-specific paths
import { Component } from "/src/components/Component"
import { Utility } from "/utils/utility"
```

### 3. Node.js Core Modules

❌ **NOT ALLOWED** - Node.js specific modules that don't exist in browsers:

```javascript
// ❌ FORBIDDEN - Browser sandbox only
import fs from 'fs'
import path from 'path'
import crypto from 'crypto'
import { promises as fsPromises } from 'fs'
```

### 4. Browser Storage APIs

❌ **NOT ALLOWED** - Direct storage access (use React state instead):

```javascript
// ❌ FORBIDDEN - Use React state instead
localStorage.getItem('theme')
sessionStorage.setItem('user', JSON.stringify(data))
```

### 5. Global Window Properties

❌ **NOT ALLOWED** - Direct global access:

```javascript
// ❌ FORBIDDEN - Use React DOM APIs instead
document.querySelector('.my-element')
window.location.hash = 'section'
```

## Allowed Import Patterns

### 1. NPM Packages via CDN

✅ **ALLOWED** - Use esm.sh for package imports:

```javascript
// ✅ CORRECT - Use esm.sh CDN
import { useState, useEffect } from 'react';
import { Dialog } from '@radix-ui/react-dialog';
import { motion } from 'framer-motion';
import { Button } from 'react-bootstrap';
```

### 2. Radix UI Primitives

✅ **ALLOWED** - Use Radix UI primitives for accessible components:

```javascript
// ✅ CORRECT - Radix UI with Tailwind CSS
import { Dialog, DialogTrigger, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@radix-ui/react-dialog';
import { Button } from '@radix-ui/react-button';
import { Input } from '@radix-ui/react-input';
```

### 3. Popular UI Libraries

✅ **ALLOWED** - Common React UI libraries:

```javascript
// ✅ CORRECT - Popular libraries work fine
import { useTransition, animated } from '@react-spring/web';
import { Modal, Button as BootstrapButton } from 'react-bootstrap';
import { Select } from 'react-select';
import { Calendar } from 'react-calendar';
```

### 4. Chart and Visualization Libraries

✅ **ALLOWED** - Data visualization packages:

```javascript
// ✅ CORRECT - Chart libraries
import { Bar, Line, Pie } from 'react-chartjs-2';
import { ResponsiveContainer } from 'recharts';
import { VictoryBar, VictoryChart, VictoryTheme } from 'victory';
```

### 5. Utility Libraries

✅ **ALLOWED** - Helper libraries:

```javascript
// ✅ CORRECT - Utility libraries
import { debounce, throttle } from 'lodash-es';
import { format, parseISO } from 'date-fns';
import { clsx, twMerge } from 'tailwind-merge';
```

## Approved Package List

### Core Dependencies

| Package | Version | Use Cases | Notes |
|---------|---------|-----------|-------|
| **react** | ^18.3.1 | Base React functionality | Required for all artifacts |
| **react-dom** | ^18.3.1 | DOM rendering | Required for all artifacts |
| **@radix-ui/react-*** | ^1.0.0 | Accessible primitives | Primary UI building blocks |
| **tailwindcss** | ^3.4.0 | Utility-first styling | Already configured |

### UI Components

| Package | Version | Use Cases | Features |
|---------|---------|-----------|---------|
| **framer-motion** | ^10.16.0 | Animations | Spring physics, layout animations |
| **@radix-ui/react-dialog** | ^1.0.5 | Modal dialogs | Accessible, customizable |
| **@radix-ui/react-dropdown-menu** | ^2.0.6 | Dropdown menus | Keyboard navigation, submenus |
| **@radix-ui/react-tabs** | ^1.0.4 | Tabbed interfaces | Keyboard accessible |
| **@radix-ui/react-toast** | ^1.1.5 | Toast notifications | Queue management, auto-dismiss |
| **react-hot-toast** | ^2.4.1 | Toast system | Custom styling, loading states |
| **react-bootstrap** | ^2.9.0 | Bootstrap components | Dropdowns, modals, forms |
| **shadcn/ui** | ^1.0.0 | Pre-built components | Directly install packages, not CLI |

### Form Libraries

| Package | Version | Use Cases | Features |
|---------|---------|-----------|---------|
| **react-hook-form** | ^7.47.0 | Form management | Validation, dirty tracking |
| **@hookform/resolvers** | ^3.3.2 | Form validation | Zod, Yup, Joi support |
| **react-select** | ^5.8.0 | Select dropdowns | Async options, creatable |
| **react-datepicker** | ^4.25.0 | Date picker | Localization, disabled dates |

### Charts & Data Viz

| Package | Version | Use Cases | Features |
|---------|---------|-----------|---------|
| **recharts** | ^2.8.0 | Responsive charts | Multiple chart types, tooltips |
| **react-chartjs-2** | ^5.2.0 | Chart.js integration | Wide chart support, themes |
| **victory** | ^36.6.11 | Victory charts | Native SVG, animations |
| **nivo** | ^0.84.0 | Data viz library | D3-powered, themeable |

### Animation Libraries

| Package | Version | Use Cases | Features |
|---------|---------|-----------|---------|
| **@react-spring/web** | ^9.7.0 | Web animations | Spring physics, scroll effects |
| **framer-motion** | ^10.16.0 | All-purpose animations | Gestures, layout animations |
| **react-transition-group** | ^4.4.5 | Transition effects | Enter/exit animations |

### Utility Libraries

| Package | Version | Use Cases | Features |
|---------|---------|-----------|---------|
| **lodash-es** | ^4.17.21 | Utility functions | Tree shaking, ES modules |
| **date-fns** | ^2.30.0 | Date manipulation | Functional, modular |
| **clsx** | ^2.0.0 | Conditional classes | Simple utility |
| **tailwind-merge** | ^2.0.0 | Tailwind class merging | Performance optimization |

## Special Cases and Workarounds

### 1. React Import Pattern

✅ **BEST PRACTICE** - React can be accessed globally:

```javascript
// ✅ CORRECT - No import needed
const { useState, useEffect, useRef } = React;

// ✅ CORRECT - Alternative pattern
const useState = React.useState;
const useEffect = React.useEffect;
```

### 2. Direct Function Access

✅ **ALLOWED** - Access functions directly from global objects:

```javascript
// ✅ CORRECT - Math utilities
const sum = (a, b) => a + b;
const random = () => Math.random();

// ✅ CORRECT - String methods
const capitalize = str => str.charAt(0).toUpperCase() + str.slice(1);
```

### 3. Inline Styling

✅ **ALLOWED** - Use inline styles with CSS-in-JS:

```javascript
// ✅ CORRECT - Inline styles
const Card = () => (
  <div style={{
    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
    borderRadius: '8px',
    padding: '16px',
    color: 'white'
  }}>
    Styled Card
  </div>
);
```

## Sandbox Limitations

### Environment Restrictions

1. **No Node.js APIs**: `fs`, `path`, `crypto`, etc.
2. **No Direct DOM Access**: Use React DOM APIs instead
3. **No LocalStorage**: Use React state or context
4. **No Fetch API**: Artifacts can't make network requests directly
5. **No CSS Imports**: Use Tailwind classes or inline styles

### Dependency Constraints

1. **Bundle Size**: Keep under 100KB per artifact
2. **Package Versions**: Use compatible versions
3. **Tree Shaking**: Import only needed components
4. **Circular Dependencies**: Avoid at all costs

## Auto-Fix System

The validator automatically fixes common issues:

### Import Transformations

```javascript
// ❌ Original
import React from 'react';
import { useState } from 'react';

// ✅ Auto-fixed
const { useState } = React;
```

### Syntax Corrections

```javascript
// ❌ Original
const * as Component from 'package-name';

// ✅ Auto-fixed
import * as Component from 'package-name';
```

### Variable Name Corrections

```javascript
// ❌ Original - reserved keyword
const enum = 'value';

// ✅ Auto-fixed
const enumValue = 'value';
```

## Error Messages and Solutions

### Common Error Scenarios

#### 1. Local Import Detected

```
❌ ERROR: Local imports not allowed
   Found: import { Button } from "@/components/ui/button"

✅ SOLUTION: Use Radix UI instead
   import { Button } from "@radix-ui/react-button"

   OR: Use Tailwind classes
   <button className="px-4 py-2 bg-blue-500 text-white rounded">
```

#### 2. LocalStorage Detected

```
❌ ERROR: localStorage not supported in artifacts
   Found: localStorage.getItem('theme')

✅ SOLUTION: Use React state
   const [theme, setTheme] = useState('light');

   Save: setTheme('dark');
   Read: theme;
```

#### 3. Invalid Import Syntax

```
❌ ERROR: Invalid import syntax
   Found: const * as Package from "package";

✅ SOLUTION: Use correct syntax
   import * as Package from "package";
```

### Validation Levels

1. **Error**: Blocking issues that prevent artifact execution
2. **Warning**: Non-critical issues that may cause problems
3. **Info**: Helpful suggestions for better practices

## Testing Artifacts

### Validation Test

```javascript
// Test if artifact imports are valid
function validateArtifactImports(code) {
  const errors = [];

  // Check for forbidden patterns
  const forbiddenPatterns = [
    /import\s+.*\s+from\s+['"]@\/components/gi,
    /localStorage\.(getItem|setItem|removeItem)/gi,
    /sessionStorage\.(getItem|setItem|removeItem)/gi,
    /import\s+.*\s+from\s+['"]\//gi
  ];

  forbiddenPatterns.forEach((pattern, index) => {
    if (pattern.test(code)) {
      errors.push(`Forbidden pattern ${index + 1} detected`);
    }
  });

  return { valid: errors.length === 0, errors };
}
```

### Browser Compatibility Test

```javascript
// Test artifact in actual browser environment
async function testArtifactInBrowser(artifactCode) {
  try {
    // Create isolated iframe
    const iframe = document.createElement('iframe');
    iframe.style.display = 'none';
    document.body.appendChild(iframe);

    // Write artifact content
    iframe.contentDocument.write(`
      <!DOCTYPE html>
      <html>
      <head><script src="https://unpkg.com/react@18.3.1/umd/react.development.js"></script></head>
      <body>
        <script>${artifactCode}</script>
      </body>
      </html>
    `);

    return { success: true };
  } catch (error) {
    return { success: false, error };
  }
}
```

## Performance Guidelines

### Bundle Size Optimization

1. **Import Specific Components**:
   ```javascript
   // ❌ Large bundle
   import * as ChartJS from 'chart.js';

   // ✅ Specific import
   import { Chart as ChartJS, CategoryScale, LinearScale } from 'chart.js';
   ```

2. **Use Tree-Shakable Versions**:
   ```javascript
   // ✅ Tree-shakable
   import { debounce } from 'lodash-es';

   // ❌ Not tree-shakable
   import _ from 'lodash';
   ```

3. **Limit Dependencies**: Keep artifact dependencies minimal

### Loading Performance

1. **Lazy Load Large Components**:
   ```javascript
   // ✅ Lazy loading
   const HeavyChart = React.lazy(() => import('./HeavyChart'));
   ```

2. **Code Splitting**: Split large artifacts into smaller pieces

## Migration Guide

### From Old Import Patterns

#### Step 1: Replace Local Imports

```javascript
// Before
import { Button } from "@/components/ui/button";
import { Card } from "./components/card";

// After
import { Button } from "@radix-ui/react-button";
import { Card } from "@radix-ui/react-card";
```

#### Step 2: Replace Storage APIs

```javascript
// Before
const theme = localStorage.getItem('theme');

// After
const [theme, setTheme] = React.useState('light');
```

#### Step 3: Add Validation

```javascript
// Add this to development workflow
npm run validate-artifacts
```

### Testing After Migration

1. Run `npm test` to verify all tests pass
2. Test artifact generation with various prompts
3. Verify all artifact types work correctly
4. Check browser console for errors

## Troubleshooting

### Debug Steps

1. **Check Console Errors**:
   ```javascript
   // Add to artifact for debugging
   console.log('Artifact loaded:', { dependencies: { React } });
   ```

2. **Validate Imports**:
   ```bash
   # Run import validation
   npm run validate:imports
   ```

3. **Inspect Bundle Size**:
   ```bash
   # Check artifact size
   npm run analyze:artifact
   ```

### Common Issues and Fixes

| Issue | Fix |
|-------|-----|
| "React is not defined" | Add `const { useState, useEffect } = React;` |
| "Module not found" | Check package name and version |
| "Invalid hook call" | Ensure React import is global |
| "Context undefined" | Wrap provider around component |

## Best Practices Summary

1. **Use Radix UI primitives** for building blocks
2. **Import specific functions** from libraries
3. **Avoid any local project references**
4. **Use React state** instead of localStorage
5. **Keep dependencies minimal** and tree-shakable
6. **Test artifacts** in isolation
7. **Follow the approved package list**
8. **Use inline styles** or Tailwind classes

---

*Last Updated: 2025-12-08*